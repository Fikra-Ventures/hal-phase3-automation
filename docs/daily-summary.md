# Daily Slack Summary Agent

## Purpose

The Daily Slack Summary agent is an automated n8n workflow that provides a comprehensive daily overview of ticket activity from the previous day. It aggregates Airtable tickets by product and priority, then delivers a formatted summary to a designated Slack channel using rich Block Kit formatting.

This automation helps teams stay informed about:
- Yesterday's ticket creation volume
- Distribution of tickets by product area
- Priority breakdown of new tickets
- Overall team activity trends

## Schedule & Frequency

- **Schedule**: Daily at 09:00 UTC
- **Frequency**: Once per day, Monday through Sunday
- **Cron Expression**: `0 9 * * *`
- **Data Range**: Aggregates tickets created in the previous calendar day

The workflow runs automatically via the n8n cron trigger and requires no manual intervention.

## Required Environment Variables

The following environment variables must be configured for the workflow to function properly:

### Airtable Integration
- `AIRTABLE_API_KEY` - Airtable API key for accessing the task database
  - Format: `pat...`
  - Purpose: Authenticate with Airtable API to fetch ticket data
  
- `AIRTABLE_BASE_ID` - Airtable base identifier containing the task tracking tables
  - Format: `app...`
  - Purpose: Specify which Airtable base contains the ticket data

### Slack Integration
- `SLACK_CHANNEL_ID_SUPPORT` - Target Slack channel ID for summary posting
  - Format: `C1234567890`
  - Purpose: Designates which Slack channel receives the daily summary
  
- `SLACK_BOT_TOKEN` - Slack Bot Token for posting messages
  - Format: `xoxb-...`
  - Purpose: Authenticate with Slack API to post formatted messages

## Workflow Components

### 1. Daily Trigger
- Cron-based trigger executing at 09:00 UTC daily
- Initiates the entire workflow chain

### 2. Airtable Data Retrieval
- Fetches tickets created yesterday using date filtering
- Sorts results by priority (descending)
- Retrieves key fields: Task, Priority, Product, Status, Owner, Created Time

### 3. Data Aggregation
- Groups tickets by product and priority
- Calculates total counts and distributions
- Prepares structured summary data

### 4. Block Kit Formatting
- Transforms raw data into Slack Block Kit format
- Adds priority emojis and visual formatting
- Creates rich, interactive message layout

### 5. Slack Posting
- Delivers formatted summary to designated channel
- Uses Block Kit for enhanced visual presentation
- Posted by HAL Bot with robot emoji

## Example Block Kit Output

```json
{
  "text": "Daily Ticket Summary - 2024-09-21",
  "blocks": [
    {
      "type": "header",
      "text": {
        "type": "plain_text",
        "text": "ðŸ“Š Daily Ticket Summary - 2024-09-21"
      }
    },
    {
      "type": "section",
      "text": {
        "type": "mrkdwn",
        "text": "*Yesterday's Activity:* 12 tickets created"
      }
    },
    {
      "type": "section",
      "text": {
        "type": "mrkdwn",
        "text": "*By Priority:* ðŸ”´ critical: 2 â€¢ ðŸŸ  high: 5 â€¢ ðŸŸ¡ medium: 4 â€¢ ðŸŸ¢ low: 1"
      }
    },
    {
      "type": "divider"
    },
    {
      "type": "section",
      "text": {
        "type": "mrkdwn",
        "text": "*By Product:*"
      }
    },
    {
      "type": "section",
      "text": {
        "type": "mrkdwn",
        "text": "*Memory Management*\n6 tickets (ðŸ”´ critical: 1 â€¢ ðŸŸ  high: 3 â€¢ ðŸŸ¡ medium: 2)"
      }
    },
    {
      "type": "section",
      "text": {
        "type": "mrkdwn",
        "text": "*Guardrails & Safety*\n4 tickets (ðŸ”´ critical: 1 â€¢ ðŸŸ  high: 2 â€¢ ðŸŸ¡ medium: 1)"
      }
    },
    {
      "type": "section",
      "text": {
        "type": "mrkdwn",
        "text": "*Performance Monitoring*\n2 tickets (ðŸŸ  high: 1 â€¢ ðŸŸ¢ low: 1)"
      }
    },
    {
      "type": "divider"
    },
    {
      "type": "context",
      "elements": [
        {
          "type": "mrkdwn",
          "text": "Generated by HAL Phase 3 Automation System"
        }
      ]
    }
  ]
}
```

## Visual Elements

- **Header**: Clear date and summary title
- **Priority Emojis**: ðŸ”´ Critical, ðŸŸ  High, ðŸŸ¡ Medium, ðŸŸ¢ Low
- **Product Sections**: Organized breakdown by product area
- **Dividers**: Clean visual separation between sections
- **Context Footer**: Attribution to HAL automation system

## Error Handling

- If no tickets are found for the previous day, displays a positive "No tickets created" message
- Handles missing or null field values gracefully
- Uses fallback values for undefined products ("Unknown") and priorities ("medium")
- Continues operation even if some data fields are incomplete

## Integration Notes

- Integrates seamlessly with existing HAL Phase 3 automation infrastructure
- Follows established patterns for Slack Block Kit formatting
- Uses consistent emoji and styling conventions
- Designed for minimal maintenance and high reliability